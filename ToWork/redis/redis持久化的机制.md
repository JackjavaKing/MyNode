

[TOC]



## redis  持久化的机制   集群搭建的哨兵机制

```
引言：
首先我们来聊一聊redis

我们的redis服务是基于我们的***内存***以及多路复用机制***epoll机制***实现的

Redis 6.0 之后的版本开始选择性使用多线程模型。

为什么从6.0后考虑多线程呢？那是因为我们的redis的处理业务场景的瓶颈不是我们的cpu，任然是我们的网络io操作，若是对于比较大的io（大键值对的增删操作）其实会对我们的主线程有阻塞的影响的
```

##### redis是什么？

**内存**高速缓存**数据库**，说到底还是数据库

Redis的存储分为**内存存储**、**磁盘存储**和**log文件**三部分

##### 简单区别（与memcache）

| 比较类别       | Redis                                                        | memcached                                                    |
| -------------- | ------------------------------------------------------------ | ------------------------------------------------------------ |
| 支持的数据结构 | 哈希、列表、集合、有序集合                                   | 纯kev-value                                                  |
| 持久化支持     | 有                                                           | 无                                                           |
| 高可用支持     | redis支持集群功能，可以实现主动复制，读写分离。官方也提供了sentinel集群管理工具，能够实现主从服务监控，故障自动转移，这一切，对于客户端都是透明的，无需程序改动，也无需人工介入 | 需要二次开发                                                 |
| 存储value容量  | 最大512M                                                     | 最大1M                                                       |
| 内存分配       | 临时申请空间，可能导致碎片                                   | 预分配内存池的方式管理内存，能够省去内存分配时间             |
| 虚拟内存使用   | 有自己的VM机制，理论上能够存储比物理内存更多的数据，当数据超量时，会引发swap，把冷数据刷到磁盘上 | 所有的数据存储在物理内存里                                   |
| 网络模型       | 非阻塞IO复用模型,提供一些非KV存储之外的排序，聚合功能，在执行这些功能时，复杂的CPU计算，会阻塞整个IO调度 | 非阻塞IO复用模型                                             |
| 水平扩展的支持 | redis cluster 可以横向扩展                                   | 暂无                                                         |
| 多线程         | Redis支持单线程                                              | Memcached支持多线程,CPU利用方面Memcache优于Redis             |
| 过期策略       | 有专门线程，清除缓存数据                                     | 懒淘汰机制：每次往缓存放入数据的时候，都会存一个时间，在读取的时候要和设置的时间做TTL比较来判断是否过期 |
| 单机QPS        | 约10W                                                        | 约60W                                                        |
| 源代码可读性   | 代码清爽简洁                                                 | 能是考虑了太多的扩展性，多系统的兼容性，代码不清爽           |
| **适用场景**   | 复杂数据结构、有持久化、高可用需求、value存储内容较大        | 纯KV，数据量非常大，并发量非常大的业务                       |

```python
（提示：QPS即每秒查询率，是对一个特定的查询服务器在规定时间内所处理流量多少的衡量标准。

QPS （fetches/sec）= 并发量 / 平均响应时间

即每秒的响应请求数，也即是最大吞吐能力。）

***拓展***(rt tps qps) 

RT(Response Time): 1个请求所完成的时间
QPS(Query Per Second): 1秒钟内所完成的请求数量
TPS(Transactions Pre Second)：tps为事务每秒的请求次数
TPS一般反映服务端系统的性能，系统性能评价以最低的TPS值为准
```



##### redis的持久化机制（aof rdb）







##### 单点redis的缺点以及解决方案

![image-20220826085202435](C:\Users\HP\AppData\Roaming\Typora\typora-user-images\image-20220826085202435.png)

